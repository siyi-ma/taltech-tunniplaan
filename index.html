<!DOCTYPE html>
<html lang="et">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TalTech kursused sügis 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body { font-family: 'Proxima Nova', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji"; line-height: 1.4; }
        .proxima-nova-bold { font-weight: 700; }
        .tt-dark-blue { color: #342b60; }
        .bg-tt-dark-blue { background-color: #342b60; }
        .hover\:bg-tt-dark-blue-hover:hover { background-color: #2a224d; }
        .tt-light-blue { color: #4dbed2; }
        .bg-tt-light-blue { background-color: #4dbed2; }
        .border-tt-light-blue { border-color: #4dbed2; }
        .tt-grey-1 { color: #9396b0; }
        .border-tt-grey-1 { border-color: #9396b0; }
        .tt-magenta { color: #e4067e; }
        .bg-tt-magenta { background-color: #e4067e; }
        .border-tt-magenta { border-color: #e4067e; }
        .focus\:ring-tt-magenta:focus { --tw-ring-color: #e4067e; }
        .text-tt-magenta { color: #e4067e; }
        .accent-tt-magenta { accent-color: #e4067e; }
        .tt-grey-2 { color: #dadae4; }
        .bg-tt-grey-2 { background-color: #dadae4; }

        .headline { font-family: 'Proxima Nova', sans-serif; font-weight: 700; text-transform: uppercase; }
        .body-text { font-family: 'Proxima Nova', sans-serif; font-weight: 400; text-transform: none; }

        .tooltip { position: relative; display: inline-block; cursor: help; }
        .tooltip .tooltiptext {
            visibility: hidden;
            width: max-content;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 10px;
            position: absolute;
            z-index: 10;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem; /* 14px */
            font-weight: normal;
            text-transform: none;
        }
        .tooltip:hover .tooltiptext { visibility: visible; opacity: 1; }

        #filterPanel {
            transition: transform 0.3s ease-in-out;
        }
        .filter-drawer-open {
            transform: translateX(0) !important;
        }
        #suggestionsContainer::-webkit-scrollbar {
            width: 8px;
        }
        #suggestionsContainer::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #suggestionsContainer::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        #suggestionsContainer::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
        .suggestion-highlight {
            font-weight: 700; 
        }
        .filter-pill {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            background-color: #e9ecef; 
            color: #495057; 
            border-radius: 9999px; 
            font-size: 0.875rem;
            border: 1px solid #ced4da; 
        }
        .filter-pill-remove {
            margin-left: 0.5rem;
            background: none;
            border: none;
            color: #6c757d; 
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        .filter-pill-remove:hover {
            color: #343a40; 
        }
    </style>
</head>
<body class="bg-white text-black body-text">

    <!-- Header -->
    <header class="sticky top-0 z-50 bg-tt-dark-blue text-white p-4 shadow-md">
        <div class="container mx-auto flex items-center justify-between">
            <div class="flex items-center">
                <button id="filterToggleButton" class="mr-4 p-2 text-white hover:bg-tt-dark-blue-hover rounded" aria-label="Ava filtrid">
                    <i class="fas fa-bars fa-lg"></i>
                </button>
                <h1 id="pageTitle" class="text-2xl proxima-nova-bold uppercase">TalTech kursused sügis 2025</h1>
            </div>
            <div class="flex items-center gap-3">
                <button id="createCalendarButton" class="p-2 bg-tt-light-blue hover:bg-opacity-80 rounded text-white text-sm proxima-nova-bold hidden" aria-label="Loo kalender">
                    <i class="fas fa-calendar-plus mr-1"></i> <span id="calendarButtonText">Loo kalender</span> (<span id="selectedCount">0</span>)
                </button>
                <button id="languageToggle" class="p-2 bg-tt-magenta hover:bg-opacity-80 rounded" aria-label="Switch language">
                    <i class="fas fa-globe"></i> <span id="langIndicator">EN</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Search Area -->
    <div class="container mx-auto p-4 my-4 bg-gray-50 bg-opacity-90 rounded shadow">
        <div class="flex flex-col md:flex-row md:items-end gap-4">
            <div class="flex-grow relative md:w-3/5">
                <label for="searchInput" id="searchInputLabel" class="block text-sm font-medium text-gray-700 mb-1">Otsisõna</label>
                <input type="search" id="searchInput" class="p-2 border border-gray-300 bg-white bg-opacity-90 rounded-md w-full body-text" placeholder="Sisesta otsisõna...">
                <div id="suggestionsContainer" class="absolute left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-[60] hidden max-h-60 overflow-y-auto text-sm">
                    <!-- Suggestions -->
                </div>
            </div>
            <div class="md:w-1/5">
                <label for="searchFieldSelector" id="searchFieldSelectorLabel" class="block text-sm font-medium text-gray-700 mb-1">Otsi väljal</label>
                <select id="searchFieldSelector" class="p-2 border border-gray-300 bg-white bg-opacity-90 rounded-md w-full text-sm h-[2.625rem]"> 
                    <option value="all">Kõik väljad</option>
                    <option value="title">Aine nimetus</option>
                    <option value="course_id">Kursuse kood</option>
                    <option value="keyword">Õppejõud/Ruum/Rühm</option>
                </select>
            </div>
            <div class="flex gap-2 mt-2 md:mt-0">
                <button id="searchButton" class="bg-tt-magenta text-white p-2 rounded hover:bg-opacity-80 headline text-sm flex-grow md:flex-grow-0 h-[2.625rem]">
                    <i class="fas fa-search mr-1"></i> <span id="searchButtonText">Otsi</span>
                </button>
                <button id="resetSearchButton" class="bg-gray-300 text-gray-700 p-2 rounded hover:bg-gray-400 headline text-sm flex-grow md:flex-grow-0 h-[2.625rem]">
                    <i class="fas fa-undo mr-1"></i> <span id="resetSearchButtonText">Lähtesta</span>
                </button>
            </div>
        </div>
    </div>


    <!-- Filter Panel -->
    <aside id="filterPanel" class="bg-gray-50 bg-opacity-95 p-4 shadow-lg fixed inset-y-0 left-0 transform -translate-x-full z-40 w-3/5 sm:w-2/5 md:w-1/3 lg:w-1/4 xl:w-1/5 overflow-y-auto mt-16 max-h-[calc(100%-4rem)] transition-transform duration-300 ease-in-out rounded-r-lg">
        <div class="flex justify-between items-center mb-4">
            <h2 id="filtersTitle" class="text-xl headline tt-dark-blue">Filtrid</h2>
            <button id="closeFilterButton" class="text-tt-magenta hover:text-tt-dark-blue">
                <i class="fas fa-times fa-lg"></i>
            </button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label for="schoolFilter" id="schoolFilterLabel" class="block text-sm font-medium tt-dark-blue headline">Kursuse tüüp</label>
                <select id="schoolFilter" class="mt-1 block w-full p-2 border-tt-grey-1 rounded-md shadow-sm focus:border-tt-magenta focus:ring focus:ring-tt-magenta focus:ring-opacity-50 text-sm">
                    <option value="">Kõik tüübid</option>
                </select>
            </div>
            <div id="instituteFilterContainer">
                <label for="instituteFilter" id="instituteFilterLabel" class="block text-sm font-medium tt-dark-blue headline">Õppenädal</label>
                <select id="instituteFilter" class="mt-1 block w-full p-2 border-tt-grey-1 rounded-md shadow-sm focus:border-tt-magenta focus:ring focus:ring-tt-magenta focus:ring-opacity-50 text-sm">
                    <option value="">Kõik nädalad</option>
                </select>
            </div>

            <div>
                <label for="assessmentFormFilter" id="assessmentFormFilterLabel" class="block text-sm font-medium tt-dark-blue headline">Õppejõud</label>
                <select id="assessmentFormFilter" class="mt-1 block w-full p-2 border-tt-grey-1 rounded-md shadow-sm focus:border-tt-magenta focus:ring focus:ring-tt-magenta focus:ring-opacity-50 text-sm">
                    <option value="">Kõik õppejõud</option>
                </select>
            </div>
            <div>
                <label id="languageFilterLabel" class="block text-sm font-medium tt-dark-blue headline mb-1">Õppekeel</label>
                <div class="space-y-1">
                    <label class="flex items-center text-sm">
                        <input type="radio" name="languageFilter" value="" class="focus:ring-tt-magenta h-4 w-4 text-tt-magenta border-tt-grey-1" checked> 
                        <span id="langAllLabel" class="ml-2">Kõik</span>
                    </label>
                    <label class="flex items-center text-sm">
                        <input type="radio" name="languageFilter" value="et" class="focus:ring-tt-magenta h-4 w-4 text-tt-magenta border-tt-grey-1">
                        <span id="langEtLabel" class="ml-2">Eesti keel</span>
                    </label>
                    <label class="flex items-center text-sm">
                        <input type="radio" name="languageFilter" value="en" class="focus:ring-tt-magenta h-4 w-4 text-tt-magenta border-tt-grey-1">
                        <span id="langEnLabel" class="ml-2">Inglise keel</span>
                    </label>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="container mx-auto p-4">
        <div class="flex justify-between items-center mb-4">
            <div class="flex items-center gap-4">
                <div id="resultsCounter" class="text-tt-dark-blue font-semibold"></div>
                <div class="flex bg-gray-200 rounded-lg p-1">
                    <button id="cardViewBtn" class="px-3 py-1 rounded text-sm font-medium bg-white text-tt-dark-blue shadow-sm" onclick="switchView('cards')">
                        <i class="fas fa-th-large mr-1"></i><span id="cardViewText">Kaardid</span>
                    </button>
                    <button id="weekViewBtn" class="px-3 py-1 rounded text-sm font-medium text-gray-600 hover:text-tt-dark-blue" onclick="switchView('weekly')">
                        <i class="fas fa-calendar-week mr-1"></i><span id="weekViewText">Nädal</span>
                    </button>
                </div>
            </div>
            <div id="activeFiltersDisplay">
                <!-- Active filter pills will be injected here -->
            </div>
        </div>
        
        <!-- Calendar View Modal -->
        <div id="calendarModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-6xl w-full max-h-[90vh] overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex justify-between items-center">
                            <h2 id="calendarModalTitle" class="text-2xl proxima-nova-bold tt-dark-blue">Valitud kursuste kalender</h2>
                            <button id="closeCalendarModal" class="text-gray-400 hover:text-gray-600">
                                <i class="fas fa-times fa-lg"></i>
                            </button>
                        </div>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-[70vh]">
                        <div id="calendarView" class="space-y-4">
                            <!-- Calendar content will be generated here -->
                        </div>
                    </div>
                    <div class="p-6 border-t border-gray-200 flex justify-between items-center">
                        <div class="text-sm text-gray-600">
                            <span id="calendarCourseCount"></span>
                        </div>
                        <div class="flex gap-3">
                            <button id="downloadCalendarBtn" class="bg-tt-magenta text-white px-6 py-2 rounded hover:bg-opacity-80 proxima-nova-bold">
                                <i class="fas fa-download mr-2"></i><span id="downloadBtnText">Laadi alla .ics fail</span>
                            </button>
                            <button id="cancelCalendarBtn" class="bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400 proxima-nova-bold">
                                <span id="cancelBtnText">Sulge</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <main id="courseList" class="w-full grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        </main>
        <div id="weeklyView" class="w-full hidden">
            <!-- Weekly calendar view will be rendered here -->
        </div>
    </div>
    
    <div id="loadingIndicator" class="fixed inset-0 bg-gray-500 bg-opacity-75 flex items-center justify-center z-[100] hidden">
        <div class="bg-white p-5 rounded-lg shadow-xl flex flex-col items-center">
            <i class="fas fa-spinner fa-spin fa-3x tt-dark-blue"></i>
            <p id="loadingText" class="mt-2 text-tt-dark-blue body-text">Laen andmeid...</p>
        </div>
    </div>

    <script>
        // Ensure all DOM element variables are declared at the top
        const searchInputDOM = document.getElementById('searchInput');
        const searchFieldSelectorDOM = document.getElementById('searchFieldSelector');
        const searchButtonDOM = document.getElementById('searchButton');
        const resetSearchButtonDOM = document.getElementById('resetSearchButton');
        const suggestionsContainerDOM = document.getElementById('suggestionsContainer');
        const languageToggleDOM = document.getElementById('languageToggle');
        const courseListContainerDOM = document.getElementById('courseList');
        const activeFiltersDisplayDOM = document.getElementById('activeFiltersDisplay');
        const schoolFilterDOM = document.getElementById('schoolFilter');
        const instituteFilterDOM = document.getElementById('instituteFilter');
        const eapFilterRadiosDOM = document.querySelectorAll('input[name="eapFilter"]');
        const assessmentFormFilterDOM = document.getElementById('assessmentFormFilter');
        const languageFilterRadiosDOM = document.querySelectorAll('input[name="languageFilter"]');
        const loadingIndicatorDOM = document.getElementById('loadingIndicator');
        const filterPanelDOM = document.getElementById('filterPanel');
        const filterToggleButtonDOM = document.getElementById('filterToggleButton');
        const closeFilterButtonDOM = document.getElementById('closeFilterButton');
        const pageTitleDOM = document.getElementById('pageTitle'); // Added for completeness
        const resultsCounterDOM = document.getElementById('resultsCounter');
        const cardViewBtnDOM = document.getElementById('cardViewBtn');
        const weekViewBtnDOM = document.getElementById('weekViewBtn');
        const weeklyViewDOM = document.getElementById('weeklyView');
        const createCalendarButtonDOM = document.getElementById('createCalendarButton');
        const selectedCountDOM = document.getElementById('selectedCount');

        let allCourses = [];
        let filteredCourses = [];
        let currentLanguage = 'et';
        let uniqueSearchableTerms = new Set();
        const MAX_SUGGESTIONS = 7;
        let currentView = 'cards'; // 'cards' or 'weekly'
        let selectedCourses = new Set();

        const uiTexts = {
            pageTitle: { et: 'TalTech kursused sügis 2025', en: 'TalTech Courses Autumn 2025' },
            searchInputLabel: { et: 'Otsisõna', en: 'Search term' },
            searchPlaceholder: { et: 'Sisesta otsisõna...', en: 'Insert search word...' },
            searchFieldSelectorLabel: { et: 'Otsi väljal', en: 'Search in field' },
            searchField_all: { et: 'Kõik väljad', en: 'All fields' },
            searchField_title: { et: 'Aine nimetus / Course name', en: 'Course name' },
            searchField_course_id: { et: 'Kursuse kood', en: 'Course code' },
            searchField_keyword: { et: 'Õppejõud/Ruum/Rühm', en: 'Instructor/Room/Group' },
            searchButtonText: { et: 'Otsi', en: 'Search' },
            resetSearchButtonText: { et: 'Lähtesta', en: 'Reset' },
            resultsFoundText: { et: 'sessiooni leitud', en: 'sessions found' },
            cardViewText: { et: 'Kaardid', en: 'Cards' },
            weekViewText: { et: 'Nädal', en: 'Weekly' },
            activeFiltersHeader: { et: 'Valitud filtrid:', en: 'Selected filters:'},
            clearAllFiltersButton: { et: 'Eemalda kõik filtrid', en: 'Clear all filters'},
            langIndicator: { et: 'EN', en: 'ET' },
            filterToggleButtonLabelOpen: { et: 'Ava filtrid', en: 'Open Filters' },
            filterToggleButtonLabelClose: { et: 'Sulge filtrid', en: 'Close Filters' },
            filtersTitle: { et: 'Filtrid', en: 'Filters' },
            schoolFilterLabel: { et: 'Kursuse tüüp', en: 'Course Type' },
            allSchools: { et: 'Kõik tüübid', en: 'All Types' },
            instituteFilterLabel: { et: 'Õppenädal', en: 'Study Week' },
            allInstitutes: { et: 'Kõik nädalad', en: 'All Weeks' },
            selectInstitute: { et: 'Vali nädal', en: 'Select Week' },
            eapFilterLabel: { et: 'EAP', en: 'ECTS (Credits)' },
            eapAllLabel: { et: 'Kõik', en: 'All' },
            eap3Label: { et: '3 EAP', en: '3 ECTS' },
            eap6Label: { et: '6 EAP', en: '6 ECTS' },
            eap9Label: { et: '9 EAP', en: '9 ECTS' },
            assessmentFormFilterLabel: { et: 'Õppejõud', en: 'Instructor' },
            allAssessmentForms: { et: 'Kõik õppejõud', en: 'All Instructors' },
            languageFilterLabel: { et: 'Õppekeel', en: 'Teaching Language' },
            langAllLabel: { et: 'Kõik', en: 'All' },
            langEtEnLabel: { et: 'Eesti ja Inglise keel', en: 'Estonian and English' }, 
            langEtLabel: { et: 'Eesti keel', en: 'Estonian' },
            langEnLabel: { et: 'Inglise keel', en: 'English' },
            eapTooltip: { et: 'EAP', en: 'ECTS' },
            eapFull: { et: 'Euroopa ainepunktisüsteemi ainepunktid', en: 'European Credit Transfer and Accumulation System credits'},
            semester: { et: 'Semester', en: 'Semester' },
            assessment: { et: 'Hindamisvorm', en: 'Assessment Form' },
            objectives: { et: 'Eesmärgid', en: 'Objectives' },
            learningOutcomes: { et: 'Õpiväljundid', en: 'Learning Outcomes' },
            literature: { et: 'Kirjandus', en: 'Literature' },
            courseCardLink: { et: 'Kursuse kaart', en: 'Course Card' },
            timetableLink: { et: 'Tunniplaan', en: 'Timetable' },
            showMore: { et: 'Näita rohkem', en: 'Show more' },
            showLess: { et: 'Näita vähem', en: 'Show less' },
            noCoursesFound: { et: 'Vastavaid sessioone ei leitud.', en: 'No matching sessions found.' },
            loadingText: { et: 'Laen andmeid...', en: 'Loading data...' },
            calendarButtonText: { et: 'Vaata kalendrit', en: 'View Calendar' },
            calendarModalTitle: { et: 'Valitud kursuste kalender', en: 'Selected Courses Calendar' },
            downloadBtnText: { et: 'Laadi alla .ics fail', en: 'Download .ics file' },
            cancelBtnText: { et: 'Sulge', en: 'Close' },
        };

        let activeFilters = {
            searchTerm: '',
            searchFieldType: 'all', 
            school: '',
            institute: '',
            eap: '',
            assessmentForm: '',
            teachingLanguage: '', 
        };
        
        function debounce(func, delay) {
            let timeout;
            return function(...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), delay);
            };
        }

        function setLanguage(lang) {
            console.log("Setting language to:", lang);
            currentLanguage = lang;
            document.documentElement.lang = lang;
            hideSuggestions();
            updateAllUITexts();
            populateFilterOptions(); 
            applyAllFiltersAndRenderDisplay(); 
        }

        function updateAllUITexts() {
            console.log("Updating UI texts for language:", currentLanguage);
            Object.keys(uiTexts).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                     if (element.id === 'searchInput' && key === 'searchPlaceholder') {
                        element.placeholder = uiTexts[key][currentLanguage];
                    } else {
                         element.textContent = uiTexts[key][currentLanguage];
                    }
                }
            });
            if (searchFieldSelectorDOM) {
                searchFieldSelectorDOM.options[0].textContent = uiTexts.searchField_all[currentLanguage];
                searchFieldSelectorDOM.options[1].textContent = uiTexts.searchField_title[currentLanguage];
                searchFieldSelectorDOM.options[2].textContent = uiTexts.searchField_course_id[currentLanguage];
                searchFieldSelectorDOM.options[3].textContent = uiTexts.searchField_keyword[currentLanguage];
            }
            
            const langIndicator = document.getElementById('langIndicator');
            if (langIndicator) langIndicator.textContent = uiTexts.langIndicator[currentLanguage === 'et' ? 'en' : 'et'];

            // Update calendar button text
            const calendarButtonTextElement = document.getElementById('calendarButtonText');
            if (calendarButtonTextElement) {
                calendarButtonTextElement.textContent = uiTexts.calendarButtonText[currentLanguage];
            }

            // Update modal texts
            const calendarModalTitleElement = document.getElementById('calendarModalTitle');
            if (calendarModalTitleElement) {
                calendarModalTitleElement.textContent = uiTexts.calendarModalTitle[currentLanguage];
            }
            
            const downloadBtnTextElement = document.getElementById('downloadBtnText');
            if (downloadBtnTextElement) {
                downloadBtnTextElement.textContent = uiTexts.downloadBtnText[currentLanguage];
            }
            
            const cancelBtnTextElement = document.getElementById('cancelBtnText');
            if (cancelBtnTextElement) {
                cancelBtnTextElement.textContent = uiTexts.cancelBtnText[currentLanguage];
            }

            const filterPanelIsOpen = filterPanelDOM ? filterPanelDOM.classList.contains('filter-drawer-open') : false;
            if (filterToggleButtonDOM) filterToggleButtonDOM.setAttribute('aria-label', uiTexts[filterPanelIsOpen ? 'filterToggleButtonLabelClose' : 'filterToggleButtonLabelOpen'][currentLanguage]);
        }

        function createCourseCardHTML(course) {
            const courseName = course.aine || (currentLanguage === 'et' ? 'Nimetu kursus' : 'Untitled Course');
            const courseCode = course.ainekood || '';
            const instructor = course.oppejoud || '';
            const courseType = course.tyyp || '';
            const language = course.keel || '';
            const groups = course.ryhmad || '';
            const weekNumbers = [...new Set(course.sessions.map(s => s.oppenadalad))].filter(w => w).sort((a, b) => parseInt(a) - parseInt(b));

            let langDisplayTag = '';
            if (language === 'Eesti keel') langDisplayTag = 'ET';
            else if (language === 'English') langDisplayTag = 'EN';
            else langDisplayTag = language;

            // Format date for better display
            const formatDate = (dateStr) => {
                if (!dateStr) return '';
                const [day, month, year] = dateStr.split('.');
                const date = new Date(year, month - 1, day);
                return currentLanguage === 'et' 
                    ? date.toLocaleDateString('et-EE', { weekday: 'short', day: '2-digit', month: '2-digit' })
                    : date.toLocaleDateString('en-GB', { weekday: 'short', day: '2-digit', month: '2-digit' });
            };

            function summarizeCourseSessions(sessions) {
                if (sessions.length === 1) {
                    const s = sessions[0];
                    return {
                        dateRange: formatDate(s.date),
                        timeRange: `${s.start} - ${s.end}`,
                        sessionCount: 1
                    };
                }
                
                const dates = sessions.map(s => s.date).sort();
                const firstDate = formatDate(dates[0]);
                const lastDate = formatDate(dates[dates.length - 1]);
                
                const times = [...new Set(sessions.map(s => `${s.start} - ${s.end}`))];
                
                return {
                    dateRange: firstDate === lastDate ? firstDate : `${firstDate} - ${lastDate}`,
                    timeRange: times.length === 1 ? times[0] : `${currentLanguage === 'et' ? 'Erinevad ajad' : 'Various times'}`,
                    sessionCount: sessions.length
                };
            }

            // Get session summary
            const sessionSummary = summarizeCourseSessions(course.sessions);

            return `
                <div class="bg-white rounded-lg shadow-md border border-tt-grey-1 overflow-hidden flex flex-col">
                    <div class="p-4">
                        <div class="flex justify-between items-start mb-1">
                            <div class="flex items-center flex-grow pr-2">
                                <input type="checkbox" class="course-selector mr-3 h-4 w-4 text-tt-magenta border-gray-300 rounded focus:ring-tt-magenta" 
                                       data-course-id="${courseCode}" 
                                       data-course-data='${JSON.stringify(course).replace(/'/g, "&#39;")}'>
                                <h2 class="text-lg proxima-nova-bold uppercase">
                                    ${course.ainekavaurl ? `<a href="${course.ainekavaurl}" target="_blank" class="tt-magenta hover:underline">${courseName}</a>` : `<span class="tt-dark-blue">${courseName}</span>`}
                                </h2>
                            </div>
                            ${courseCode ? `<span class="text-md proxima-nova-bold tt-dark-blue whitespace-nowrap">${courseCode}</span>` : ''}
                        </div>
                        
                        <div class="mb-3 flex flex-wrap gap-2 items-center">
                            ${langDisplayTag ? `<span class="inline-block bg-tt-light-blue text-white text-xs font-semibold px-2.5 py-0.5 rounded">${langDisplayTag}</span>` : ''}
                            ${courseType ? `<span class="inline-block bg-gray-200 text-gray-700 text-xs font-semibold px-2.5 py-0.5 rounded">${courseType}</span>` : ''}
                            ${weekNumbers.length ? `<span class="inline-block bg-gray-200 text-tt-dark-blue text-xs font-semibold px-2.5 py-0.5 rounded">
                                ${currentLanguage === 'et' ? 'Nädalad' : 'Weeks'} ${weekNumbers.join(', ')}
                            </span>` : ''}
                            ${sessionSummary.sessionCount > 1 ? `<span class="inline-block bg-tt-magenta text-white text-xs font-semibold px-2.5 py-0.5 rounded">
                                ${sessionSummary.sessionCount} ${currentLanguage === 'et' ? 'sessiooni' : 'sessions'}
                            </span>` : ''}
                        </div>

                        <div class="text-sm text-gray-700 mb-3 space-y-1">
                            <div><i class="fas fa-calendar mr-2 text-tt-magenta"></i><strong>${sessionSummary.dateRange}</strong></div>
                            <div><i class="fas fa-clock mr-2 text-tt-magenta"></i>${sessionSummary.timeRange}</div>
                            ${instructor ? `<div><i class="fas fa-user mr-2 text-tt-magenta"></i>${instructor}</div>` : ''}
                        </div>
                        
                        ${groups ? `<p class="text-xs text-gray-500 mb-2">${currentLanguage === 'et' ? 'Rühmad' : 'Groups'}: ${groups}</p>` : ''}
                    </div>
                    <div class="px-4 pb-4 mt-auto">
                        <button class="expand-button text-tt-magenta hover:text-tt-dark-blue text-sm proxima-nova-bold" aria-expanded="false" aria-controls="details-${courseCode}">
                            <i class="fas fa-plus" data-show="fa-plus" data-hide="fa-minus"></i>
                            <span class="ml-1">${currentLanguage === 'et' ? 'Vaata sessioone' : 'View sessions'}</span>
                        </button>
                    </div>
                    <div id="details-${courseCode}" class="expandable-content hidden p-4 border-t border-tt-grey-1 bg-gray-50">
                        <div class="text-sm space-y-3">
                            <div><strong>${currentLanguage === 'et' ? 'Kursuse info' : 'Course info'}:</strong></div>
                            <div class="ml-4 space-y-1">
                                <div><strong>${currentLanguage === 'et' ? 'Kood' : 'Code'}:</strong> ${courseCode}</div>
                                <div><strong>${currentLanguage === 'et' ? 'Tüüp' : 'Type'}:</strong> ${courseType}</div>
                                <div><strong>${currentLanguage === 'et' ? 'Õppejõud' : 'Instructor'}:</strong> ${instructor}</div>
                                <div><strong>${currentLanguage === 'et' ? 'Rühmad' : 'Groups'}:</strong> ${groups}</div>
                                ${course.ainekavaurl ? `<div class="mt-2">
                                    <a href="${course.ainekavaurl}" target="_blank" class="text-tt-magenta hover:underline">
                                        <i class="fas fa-external-link-alt mr-1"></i>${currentLanguage === 'et' ? 'Aine kava' : 'Course curriculum'}
                                    </a>
                                </div>` : ''}
                            </div>
                            
                            <div><strong>${currentLanguage === 'et' ? 'Sessioonid' : 'Sessions'} (${course.sessions.length}):</strong></div>
                            <div class="ml-4 space-y-2">
                                ${course.sessions.map(session => `
                                    <div class="bg-white p-3 rounded border">
                                        <div class="flex justify-between items-start">
                                            <div>
                                                <div class="font-medium">${formatDate(session.date)}</div>
                                                <div class="text-xs text-gray-600">${session.start} - ${session.end}</div>
                                                ${session.ruum ? `<div class="text-xs text-gray-600"><i class="fas fa-map-marker-alt mr-1"></i>${session.ruum}</div>` : ''}
                                            </div>
                                            <div class="text-xs text-gray-500">
                                                ${session.oppenadalad ? `${currentLanguage === 'et' ? 'Nädal' : 'Week'} ${session.oppenadalad}` : ''}
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function groupCoursesByCode(courses) {
            const grouped = {};
            courses.forEach(course => {
                const key = course.ainekood;
                if (!grouped[key]) {
                    grouped[key] = {
                        ...course,
                        sessions: []
                    };
                }
                grouped[key].sessions.push(course);
            });
            return Object.values(grouped);
        }

        function renderCourses(coursesToRender) {
            if (currentView === 'weekly') {
                renderWeeklyView(coursesToRender);
                return;
            }
            
            if (!courseListContainerDOM) {
                console.error("courseListContainerDOM is not found!");
                return;
            }
            courseListContainerDOM.innerHTML = '';
            
            // Group courses by unique course code
            const groupedCourses = groupCoursesByCode(coursesToRender);
            
            // Update results counter
            if (resultsCounterDOM) {
                if (groupedCourses.length === 0) {
                    resultsCounterDOM.textContent = currentLanguage === 'et' ? '0 kursust leitud' : '0 courses found';
                } else {
                    const sessionCount = coursesToRender.length;
                    resultsCounterDOM.textContent = `${groupedCourses.length} ${currentLanguage === 'et' ? 'kursust' : 'courses'} (${sessionCount} ${currentLanguage === 'et' ? 'sessiooni' : 'sessions'})`;
                }
            }
            
            if (groupedCourses.length === 0) {
                courseListContainerDOM.innerHTML = `<p class="text-center text-tt-grey-1 col-span-full">${uiTexts.noCoursesFound[currentLanguage]}</p>`;
                return;
            }
            groupedCourses.forEach(course => {
                const cardHTML = createCourseCardHTML(course);
                courseListContainerDOM.insertAdjacentHTML('beforeend', cardHTML);
            });
            addExpandButtonListeners();
            document.querySelectorAll('.expand-button i').forEach(icon => {
                const parentButton = icon.closest('button');
                if (!parentButton) return;
                const content = parentButton.closest('div.flex-col').querySelector('.expandable-content');
                if (!content) return;
                const isHidden = content.classList.contains('hidden');
                if (!isHidden) {
                    icon.classList.remove(icon.dataset.show);
                    icon.classList.add(icon.dataset.hide);
                } else {
                    icon.classList.remove(icon.dataset.hide);
                    icon.classList.add(icon.dataset.show);
                }
            });
        }

        function renderWeeklyView(coursesToRender) {
            if (!weeklyViewDOM || !resultsCounterDOM) return;
            
            // Update results counter
            if (coursesToRender.length === 0) {
                resultsCounterDOM.textContent = currentLanguage === 'et' ? '0 sessiooni leitud' : '0 sessions found';
            } else {
                resultsCounterDOM.textContent = `${coursesToRender.length} ${uiTexts.resultsFoundText[currentLanguage]}`;
            }
            
            if (coursesToRender.length === 0) {
                weeklyViewDOM.innerHTML = `<p class="text-center text-tt-grey-1">${uiTexts.noCoursesFound[currentLanguage]}</p>`;
                return;
            }

            // Group sessions by week
            const weekGroups = groupSessionsByWeek(coursesToRender);
            
            let weeklyHTML = '';
            weekGroups.forEach(week => {
                weeklyHTML += `
                    <div class="mb-8 bg-white rounded-lg shadow-md border border-tt-grey-1 overflow-hidden">
                        <div class="bg-tt-dark-blue text-white p-4">
                            <h2 class="text-xl font-bold">${week.weekLabel}</h2>
                            <p class="text-sm opacity-80">${week.dateRange}</p>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-0">
                            ${renderWeekDays(week.days)}
                        </div>
                    </div>
                `;
            });
            
            weeklyViewDOM.innerHTML = weeklyHTML;
        }

        function groupSessionsByWeek(sessions) {
            const weekGroups = {};
            const weekDays = ['Esmaspäev', 'Teisipäev', 'Kolmapäev', 'Neljapäev', 'Reede', 'Laupäev', 'Pühapäev'];
            const weekDaysEn = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
            
            sessions.forEach(session => {
                if (!session.date) return;
                
                const [day, month, year] = session.date.split('.');
                const date = new Date(year, month - 1, day);
                const weekNumber = getWeekNumber(date);
                const yearWeek = `${date.getFullYear()}-W${weekNumber}`;
                
                if (!weekGroups[yearWeek]) {
                    weekGroups[yearWeek] = {
                        weekNumber,
                        year: date.getFullYear(),
                        weekLabel: currentLanguage === 'et' ? `${weekNumber}. nädal` : `Week ${weekNumber}`,
                        dateRange: getWeekDateRange(date),
                        days: {}
                    };
                    
                    // Initialize all weekdays
                    for (let i = 0; i < 5; i++) { // Only weekdays (Mon-Fri)
                        const dayName = currentLanguage === 'et' ? weekDays[i] : weekDaysEn[i];
                        weekGroups[yearWeek].days[dayName] = [];
                    }
                }
                
                const dayOfWeek = date.getDay();
                const adjustedDay = dayOfWeek === 0 ? 6 : dayOfWeek - 1; // Convert Sunday (0) to 6, others -1
                
                if (adjustedDay < 5) { // Only weekdays
                    const dayName = currentLanguage === 'et' ? weekDays[adjustedDay] : weekDaysEn[adjustedDay];
                    weekGroups[yearWeek].days[dayName].push(session);
                }
            });
            
            return Object.values(weekGroups).sort((a, b) => {
                if (a.year !== b.year) return a.year - b.year;
                return a.weekNumber - b.weekNumber;
            });
        }

        function getWeekNumber(date) {
            const firstDayOfYear = new Date(date.getFullYear(), 0, 1);
            const pastDaysOfYear = (date - firstDayOfYear) / 86400000;
            return Math.ceil((pastDaysOfYear + firstDayOfYear.getDay() + 1) / 7);
        }

        function getWeekDateRange(date) {
            const monday = new Date(date);
            monday.setDate(date.getDate() - (date.getDay() + 6) % 7);
            const friday = new Date(monday);
            friday.setDate(monday.getDate() + 4);
            
            const formatDate = (d) => {
                return d.toLocaleDateString(currentLanguage === 'et' ? 'et-EE' : 'en-GB', { 
                    day: '2-digit', 
                    month: '2-digit' 
                });
            };
            
            return `${formatDate(monday)} - ${formatDate(friday)}`;
        }

        function renderWeekDays(days) {
            const weekDays = ['Esmaspäev', 'Teisipäev', 'Kolmapäev', 'Neljapäev', 'Reede'];
            const weekDaysEn = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const dayNames = currentLanguage === 'et' ? weekDays : weekDaysEn;
            
            return dayNames.map(dayName => {
                const sessions = days[dayName] || [];
                return `
                    <div class="border-r border-gray-200 last:border-r-0">
                        <div class="bg-gray-50 p-3 text-center font-semibold text-sm text-tt-dark-blue border-b border-gray-200">
                            ${dayName}
                        </div>
                        <div class="p-2 min-h-[200px]">
                            ${sessions.map(session => createWeeklySessionCard(session)).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function createWeeklySessionCard(session) {
            const roomText = session.ruum ? `<div class="text-xs text-gray-600 truncate"><i class="fas fa-map-marker-alt mr-1"></i>${session.ruum}</div>` : '';
            
            return `
                <div class="mb-2 p-2 bg-white border border-gray-200 rounded shadow-sm hover:shadow-md transition-shadow">
                    <div class="text-xs font-semibold text-tt-magenta truncate">${session.ainekood}</div>
                    <div class="text-xs text-tt-dark-blue font-medium mb-1 truncate">${session.aine}</div>
                    <div class="text-xs text-gray-600 mb-1">${session.start} - ${session.end}</div>
                    ${roomText}
                    <div class="text-xs text-gray-500 truncate">${session.oppejoud || ''}</div>
                </div>
            `;
        }

        function switchView(view) {
            currentView = view;
            
            if (view === 'cards') {
                courseListContainerDOM.classList.remove('hidden');
                weeklyViewDOM.classList.add('hidden');
                cardViewBtnDOM.classList.add('bg-white', 'text-tt-dark-blue', 'shadow-sm');
                cardViewBtnDOM.classList.remove('text-gray-600');
                weekViewBtnDOM.classList.remove('bg-white', 'text-tt-dark-blue', 'shadow-sm');
                weekViewBtnDOM.classList.add('text-gray-600');
            } else {
                courseListContainerDOM.classList.add('hidden');
                weeklyViewDOM.classList.remove('hidden');
                weekViewBtnDOM.classList.add('bg-white', 'text-tt-dark-blue', 'shadow-sm');
                weekViewBtnDOM.classList.remove('text-gray-600');
                cardViewBtnDOM.classList.remove('bg-white', 'text-tt-dark-blue', 'shadow-sm');
                cardViewBtnDOM.classList.add('text-gray-600');
            }
            
            // Re-render with current filtered courses
            renderCourses(filteredCourses);
        }
        
        function addExpandButtonListeners() {
            document.querySelectorAll('.expand-button').forEach(button => {
                if (button.dataset.listenerAttached) return;
                button.addEventListener('click', () => {
                    const content = button.closest('div.flex-col').querySelector('.expandable-content');
                    if (!content) return;
                    const icon = button.querySelector('i');
                    const span = button.querySelector('span');
                    const isCurrentlyHidden = content.classList.contains('hidden');
                    
                    content.classList.toggle('hidden');
                    button.setAttribute('aria-expanded', String(!isCurrentlyHidden));

                    if (isCurrentlyHidden) { 
                        icon.classList.remove(icon.dataset.show); 
                        icon.classList.add(icon.dataset.hide);
                    } else { 
                        icon.classList.remove(icon.dataset.hide); 
                        icon.classList.add(icon.dataset.show);
                    }
                });
                button.dataset.listenerAttached = 'true';
            });
        }

        function applyAllFiltersAndRenderDisplay() {
            applyAllFilters();
            renderActiveFiltersDisplay();
        }
        const debouncedApplyAllFiltersAndRenderDisplay = debounce(applyAllFiltersAndRenderDisplay, 300);

        function applyAllFilters() {
            if (loadingIndicatorDOM) loadingIndicatorDOM.classList.remove('hidden');
            setTimeout(() => {
                let tempFilteredCourses = [...allCourses];
                const searchTermLower = activeFilters.searchTerm.toLowerCase();

                if (activeFilters.searchTerm) {
                    tempFilteredCourses = tempFilteredCourses.filter(session => {
                        switch (activeFilters.searchFieldType) {
                            case 'title':
                                return (session.aine && session.aine.toLowerCase().includes(searchTermLower));
                            case 'course_id':
                                return session.ainekood && session.ainekood.toLowerCase().includes(searchTermLower);
                            case 'keyword':
                                return (session.oppejoud && session.oppejoud.toLowerCase().includes(searchTermLower)) ||
                                       (session.tyyp && session.tyyp.toLowerCase().includes(searchTermLower)) ||
                                       (session.ryhmad && session.ryhmad.toLowerCase().includes(searchTermLower));
                            case 'all':
                            default:
                                return (session.ainekood && session.ainekood.toLowerCase().includes(searchTermLower)) ||
                                       (session.aine && session.aine.toLowerCase().includes(searchTermLower)) ||
                                       (session.oppejoud && session.oppejoud.toLowerCase().includes(searchTermLower)) ||
                                       (session.tyyp && session.tyyp.toLowerCase().includes(searchTermLower)) ||
                                       (session.ryhmad && session.ryhmad.toLowerCase().includes(searchTermLower)) ||
                                       (session.ruum && session.ruum.toLowerCase().includes(searchTermLower));
                        }
                    });
                }
                // Filter by course type (using school filter dropdown)
                if (activeFilters.school) {
                    tempFilteredCourses = tempFilteredCourses.filter(session => session.tyyp === activeFilters.school);
                }
                // Filter by week (using institute filter dropdown)
                if (activeFilters.institute) {
                    tempFilteredCourses = tempFilteredCourses.filter(session => session.oppenadalad === activeFilters.institute);
                }
                // Filter by instructor (using assessmentForm filter dropdown)
                if(activeFilters.assessmentForm) {
                    tempFilteredCourses = tempFilteredCourses.filter(session => session.oppejoud === activeFilters.assessmentForm);
                }
                
                const langFilter = activeFilters.teachingLanguage;
                if (langFilter === 'et') { 
                    tempFilteredCourses = tempFilteredCourses.filter(session => session.keel === "Eesti keel");
                } else if (langFilter === 'en') { 
                    tempFilteredCourses = tempFilteredCourses.filter(session => session.keel === "English");
                } 
                
                filteredCourses = tempFilteredCourses;
                renderCourses(filteredCourses);
                if (loadingIndicatorDOM) loadingIndicatorDOM.classList.add('hidden');
            }, 20);
        }
        
        function populateFilterOptions() {
            if (!schoolFilterDOM || !assessmentFormFilterDOM) {
                console.error("Filter select elements not found for populating.");
                return;
            }
            
            // For the new schedule data, we can populate with course types instead of schools
            const courseTypes = [...new Set(allCourses.map(session => session.tyyp).filter(Boolean))].sort();
            const currentSchoolValue = schoolFilterDOM.value;
            schoolFilterDOM.innerHTML = `<option value="">${currentLanguage === 'et' ? 'Kõik tüübid' : 'All types'}</option>`; 
            courseTypes.forEach(type => {
                schoolFilterDOM.add(new Option(type, type));
            });
            schoolFilterDOM.value = currentSchoolValue;

            // Populate instructors instead of assessment forms
            const instructors = [...new Set(allCourses.map(session => session.oppejoud).filter(Boolean))].sort();
            const currentAssessmentFormValue = assessmentFormFilterDOM.value;
            assessmentFormFilterDOM.innerHTML = `<option value="">${currentLanguage === 'et' ? 'Kõik õppejõud' : 'All instructors'}</option>`;
            instructors.forEach(instructor => {
                assessmentFormFilterDOM.add(new Option(instructor, instructor));
            });
            assessmentFormFilterDOM.value = currentAssessmentFormValue;
        }

        function updateInstituteFilter(selectedCourseType) {
            if (!instituteFilterDOM) {
                console.error("Institute filter DOM not found.");
                return;
            }
            const currentInstituteValue = instituteFilterDOM.value;
            instituteFilterDOM.innerHTML = `<option value="">${currentLanguage === 'et' ? 'Kõik nädalad' : 'All weeks'}</option>`;
            
            // Populate with week numbers for schedule filtering
            const weeks = [...new Set(allCourses.map(session => session.oppenadalad).filter(Boolean))].sort((a, b) => parseInt(a) - parseInt(b));
            weeks.forEach(week => {
                const label = currentLanguage === 'et' ? `Nädal ${week}` : `Week ${week}`;
                instituteFilterDOM.add(new Option(label, week));
            });
            instituteFilterDOM.disabled = false;
            
            if (weeks.includes(currentInstituteValue)) {
                instituteFilterDOM.value = currentInstituteValue;
            } else {
                activeFilters.institute = ''; 
                instituteFilterDOM.value = "";
            }
        }
        
        function compileUniqueSearchableTerms() {
            uniqueSearchableTerms.clear();
            allCourses.forEach(session => {
                if (session.ainekood) uniqueSearchableTerms.add(session.ainekood);
                if (session.aine) uniqueSearchableTerms.add(session.aine);
                if (session.oppejoud) uniqueSearchableTerms.add(session.oppejoud);
                if (session.tyyp) uniqueSearchableTerms.add(session.tyyp);
                if (session.ruum) uniqueSearchableTerms.add(session.ruum);
                if (session.ryhmad) {
                    session.ryhmad.split(',').forEach(group => uniqueSearchableTerms.add(group.trim()));
                }
            });
            console.log("Compiled unique searchable terms:", uniqueSearchableTerms.size);
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        function handleSearchInput() {
            const term = searchInputDOM.value.trim();
            activeFilters.searchTerm = searchInputDOM.value; 
            activeFilters.searchFieldType = searchFieldSelectorDOM.value;

            if (term.length < 2) { 
                hideSuggestions();
                debouncedApplyAllFiltersAndRenderDisplay(); 
                return;
            }
            const termLower = term.toLowerCase();
            const matchedSuggestions = [];
            for (const sTerm of uniqueSearchableTerms) { 
                if (sTerm.toLowerCase().includes(termLower)) {
                    matchedSuggestions.push(sTerm);
                }
                if (matchedSuggestions.length >= MAX_SUGGESTIONS * 10) break;
            }
            
            const prioritizedSuggestions = matchedSuggestions
                .sort((a, b) => { 
                    const aLower = a.toLowerCase();
                    const bLower = b.toLowerCase();
                    const aStarts = aLower.startsWith(termLower);
                    const bStarts = bLower.startsWith(termLower);

                    if (aStarts && !bStarts) return -1;
                    if (!aStarts && bStarts) return 1;
                    if (aLower.includes(termLower) && bLower.includes(termLower)) {
                        if (aLower.length < bLower.length) return -1;
                        if (aLower.length > bLower.length) return 1;
                    }
                    return aLower.localeCompare(bLower);
                })
                .slice(0, MAX_SUGGESTIONS);

            if (prioritizedSuggestions.length > 0) {
                renderSuggestions(prioritizedSuggestions, term);
            } else {
                hideSuggestions();
            }
            debouncedApplyAllFiltersAndRenderDisplay();
        }

        function renderSuggestions(suggestions, searchTerm) {
            if (!suggestionsContainerDOM) return;
            suggestionsContainerDOM.innerHTML = '';
            if (suggestions.length === 0) {
                hideSuggestions();
                return;
            }
            const ul = document.createElement('ul');
            const escapedSearchTerm = escapeRegExp(searchTerm);
            const regex = new RegExp(`(${escapedSearchTerm})`, 'gi');

            suggestions.forEach(suggestionText => {
                const li = document.createElement('li');
                let highlightedHTML = suggestionText;
                if (searchTerm.length > 0) { 
                    highlightedHTML = suggestionText.replace(regex, `<span class="suggestion-highlight">$1</span>`);
                }
                li.innerHTML = highlightedHTML; 
                li.className = 'p-2 hover:bg-tt-grey-2 cursor-pointer text-sm body-text';
                li.addEventListener('click', () => {
                    searchInputDOM.value = suggestionText; 
                    activeFilters.searchTerm = suggestionText;
                    activeFilters.searchFieldType = searchFieldSelectorDOM.value; 
                    hideSuggestions();
                    applyAllFiltersAndRenderDisplay(); 
                });
                ul.appendChild(li);
            });
            suggestionsContainerDOM.appendChild(ul);
            suggestionsContainerDOM.classList.remove('hidden');
        }

        function hideSuggestions() {
            if (suggestionsContainerDOM) {
                suggestionsContainerDOM.classList.add('hidden');
                suggestionsContainerDOM.innerHTML = '';
            }
        }

        function renderActiveFiltersDisplay() {
            if (!activeFiltersDisplayDOM) return;
            activeFiltersDisplayDOM.innerHTML = '';
            let hasActiveFilter = false;
            const pillsHTML = [];

            if (activeFilters.searchTerm) {
                hasActiveFilter = true;
                let fieldLabel = uiTexts[`searchField_${activeFilters.searchFieldType}`] ? uiTexts[`searchField_${activeFilters.searchFieldType}`][currentLanguage] : activeFilters.searchFieldType;
                pillsHTML.push(`<span class="filter-pill">${fieldLabel}: "${activeFilters.searchTerm}" 
                                <button class="filter-pill-remove" data-filtertype="searchTerm" aria-label="Eemalda otsingusõna">&times;</button>
                               </span>`);
            }
            if (activeFilters.school && schoolFilterDOM) {
                hasActiveFilter = true;
                const schoolOption = Array.from(schoolFilterDOM.options).find(opt => opt.value === activeFilters.school);
                const schoolName = schoolOption ? schoolOption.textContent : activeFilters.school;
                pillsHTML.push(`<span class="filter-pill">${uiTexts.schoolFilterLabel[currentLanguage]}: ${schoolName} 
                                <button class="filter-pill-remove" data-filtertype="school" aria-label="Eemalda kooli filter">&times;</button>
                               </span>`);
            }
            if (activeFilters.institute && instituteFilterDOM) {
                 hasActiveFilter = true;
                 const instituteOption = Array.from(instituteFilterDOM.options).find(opt => opt.value === activeFilters.institute);
                 const instituteName = instituteOption ? instituteOption.textContent : activeFilters.institute;
                 pillsHTML.push(`<span class="filter-pill">${uiTexts.instituteFilterLabel[currentLanguage]}: ${instituteName}
                                 <button class="filter-pill-remove" data-filtertype="institute" aria-label="Eemalda instituudi filter">&times;</button>
                                </span>`);
            }
            if (activeFilters.eap) {
                hasActiveFilter = true;
                pillsHTML.push(`<span class="filter-pill">${uiTexts.eapFilterLabel[currentLanguage]}: ${activeFilters.eap} EAP
                                <button class="filter-pill-remove" data-filtertype="eap" aria-label="Eemalda EAP filter">&times;</button>
                               </span>`);
            }
            if (activeFilters.assessmentForm && assessmentFormFilterDOM) {
                hasActiveFilter = true;
                 const formOption = Array.from(assessmentFormFilterDOM.options).find(opt => opt.value === activeFilters.assessmentForm);
                 const formName = formOption ? formOption.textContent : activeFilters.assessmentForm;
                pillsHTML.push(`<span class="filter-pill">${uiTexts.assessmentFormFilterLabel[currentLanguage]}: ${formName}
                                <button class="filter-pill-remove" data-filtertype="assessmentForm" aria-label="Eemalda hindamisvormi filter">&times;</button>
                               </span>`);
            }
            if (activeFilters.teachingLanguage) { 
                hasActiveFilter = true;
                let langLabel = '';
                if (activeFilters.teachingLanguage === 'et') langLabel = uiTexts.langEtLabel[currentLanguage];
                else if (activeFilters.teachingLanguage === 'en') langLabel = uiTexts.langEnLabel[currentLanguage];
                else if (activeFilters.teachingLanguage === 'et+en') langLabel = uiTexts.langEtEnLabel[currentLanguage];
                // No need for fallback to "All" here, as "" means no language filter active for display
                
                if (activeFilters.teachingLanguage !== "") { // Only show pill if not "All"
                    pillsHTML.push(`<span class="filter-pill">${uiTexts.languageFilterLabel[currentLanguage]}: ${langLabel}
                                    <button class="filter-pill-remove" data-filtertype="teachingLanguage" aria-label="Eemalda õppekeele filter">&times;</button>
                                </span>`);
                } else { // If it was the only active filter, and now it's "" (All), recalculate hasActiveFilter
                    hasActiveFilter = Object.values(activeFilters).some((val, index) => {
                        // Check if any other filter (not teachingLanguage, which is now "") is active
                        return index !== Object.keys(activeFilters).indexOf('teachingLanguage') && val !== '' && val !== 'all';
                    });
                }
            }

            if (hasActiveFilter) {
                activeFiltersDisplayDOM.innerHTML = `
                    <div class="flex flex-wrap items-center mb-2">
                        <strong class="mr-2 body-text">${uiTexts.activeFiltersHeader[currentLanguage]}</strong>
                        ${pillsHTML.join('')}
                        <button id="clearAllFiltersButton" class="text-sm text-tt-magenta hover:underline ml-2 body-text">
                            ${uiTexts.clearAllFiltersButton[currentLanguage]}
                        </button>
                    </div>`;
                
                document.querySelectorAll('.filter-pill-remove').forEach(button => {
                    button.addEventListener('click', (e) => {
                        const filterType = e.currentTarget.dataset.filtertype;
                        removeFilter(filterType);
                    });
                });
                const clearAllBtn = document.getElementById('clearAllFiltersButton');
                if (clearAllBtn) clearAllBtn.addEventListener('click', clearAllFilters);
            }
        }

        function removeFilter(filterType) {
            switch(filterType) {
                case 'searchTerm':
                    activeFilters.searchTerm = '';
                    if (searchInputDOM) searchInputDOM.value = '';
                    break;
                case 'school':
                    activeFilters.school = '';
                    if (schoolFilterDOM) schoolFilterDOM.value = '';
                    activeFilters.institute = ''; 
                    if (instituteFilterDOM) instituteFilterDOM.value = '';
                    updateInstituteFilter('');
                    break;
                case 'institute':
                    activeFilters.institute = '';
                    if (instituteFilterDOM) instituteFilterDOM.value = '';
                    break;
                case 'eap':
                    activeFilters.eap = '';
                    const eapAllRadio = document.querySelector('input[name="eapFilter"][value=""]');
                    if (eapAllRadio) eapAllRadio.checked = true;
                    break;
                case 'assessmentForm':
                    activeFilters.assessmentForm = '';
                    if (assessmentFormFilterDOM) assessmentFormFilterDOM.value = '';
                    break;
                case 'teachingLanguage':
                    activeFilters.teachingLanguage = ''; 
                    const langAllRadio = document.querySelector('input[name="languageFilter"][value=""]');
                    if (langAllRadio) langAllRadio.checked = true;
                    break;
            }
            applyAllFiltersAndRenderDisplay();
        }

        function clearAllFilters() {
            activeFilters = {
                searchTerm: '', searchFieldType: 'all', school: '', institute: '',
                eap: '', assessmentForm: '', teachingLanguage: '',
            };
            if (searchInputDOM) searchInputDOM.value = '';
            if (searchFieldSelectorDOM) searchFieldSelectorDOM.value = 'all';
            if (schoolFilterDOM) schoolFilterDOM.value = '';
            if (instituteFilterDOM) instituteFilterDOM.value = '';
            updateInstituteFilter('');
            const eapAllRadio = document.querySelector('input[name="eapFilter"][value=""]');
            if (eapAllRadio) eapAllRadio.checked = true;
            if (assessmentFormFilterDOM) assessmentFormFilterDOM.value = '';
            const langAllRadio = document.querySelector('input[name="languageFilter"][value=""]');
            if (langAllRadio) langAllRadio.checked = true;

            applyAllFiltersAndRenderDisplay();
        }
        
        function setupEventListeners() {
            console.log("Setting up event listeners...");
            if (languageToggleDOM) languageToggleDOM.addEventListener('click', () => {
                setLanguage(currentLanguage === 'et' ? 'en' : 'et');
            });

            // View toggle buttons
            if (cardViewBtnDOM) cardViewBtnDOM.addEventListener('click', () => {
                switchView('cards');
            });
            
            if (weekViewBtnDOM) weekViewBtnDOM.addEventListener('click', () => {
                switchView('weekly');
            });

            if (searchInputDOM) {
                searchInputDOM.addEventListener('input', debounce(handleSearchInput, 250)); 
                searchInputDOM.addEventListener('focus', () => {
                    if (searchInputDOM.value.trim().length >= 2) handleSearchInput();
                });
            }
            if (searchFieldSelectorDOM) searchFieldSelectorDOM.addEventListener('change', (e) => {
                activeFilters.searchFieldType = e.target.value;
                if (activeFilters.searchTerm) { 
                    applyAllFiltersAndRenderDisplay();
                }
            });
            if (searchButtonDOM) searchButtonDOM.addEventListener('click', () => {
                activeFilters.searchTerm = searchInputDOM ? searchInputDOM.value : ""; 
                activeFilters.searchFieldType = searchFieldSelectorDOM ? searchFieldSelectorDOM.value : "all"; 
                hideSuggestions();
                applyAllFiltersAndRenderDisplay();
            });
            if (resetSearchButtonDOM) resetSearchButtonDOM.addEventListener('click', () => {
                if (searchInputDOM) searchInputDOM.value = '';
                if (searchFieldSelectorDOM) searchFieldSelectorDOM.value = 'all';
                activeFilters.searchTerm = '';
                activeFilters.searchFieldType = 'all';
                hideSuggestions();
                applyAllFiltersAndRenderDisplay();
            });
            
            document.addEventListener('click', (e) => {
                if (searchInputDOM && suggestionsContainerDOM && searchButtonDOM &&
                    !searchInputDOM.contains(e.target) && 
                    !suggestionsContainerDOM.contains(e.target) && 
                    !searchButtonDOM.contains(e.target)) {
                    hideSuggestions();
                }
            });

            if (schoolFilterDOM) schoolFilterDOM.addEventListener('change', (e) => {
                activeFilters.school = e.target.value;
                activeFilters.institute = ''; 
                updateInstituteFilter(activeFilters.school);
                applyAllFiltersAndRenderDisplay();
            });
            if (instituteFilterDOM) instituteFilterDOM.addEventListener('change', (e) => {
                activeFilters.institute = e.target.value;
                applyAllFiltersAndRenderDisplay();
            });
            
            eapFilterRadiosDOM.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    activeFilters.eap = e.target.value; 
                    applyAllFiltersAndRenderDisplay();
                });
            });
            if (assessmentFormFilterDOM) assessmentFormFilterDOM.addEventListener('change', (e) => {
                activeFilters.assessmentForm = e.target.value;
                applyAllFiltersAndRenderDisplay();
            });
            languageFilterRadiosDOM.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    activeFilters.teachingLanguage = e.target.value;
                    applyAllFiltersAndRenderDisplay();
                });
            });

            if (filterToggleButtonDOM) filterToggleButtonDOM.addEventListener('click', () => {
                if (!filterPanelDOM) return;
                const isOpen = filterPanelDOM.classList.toggle('filter-drawer-open');
                const icon = filterToggleButtonDOM.querySelector('i');
                if (isOpen) {
                    icon.classList.remove('fa-bars'); icon.classList.add('fa-times');
                    filterToggleButtonDOM.setAttribute('aria-label', uiTexts.filterToggleButtonLabelClose[currentLanguage]);
                } else {
                    icon.classList.remove('fa-times'); icon.classList.add('fa-bars');
                    filterToggleButtonDOM.setAttribute('aria-label', uiTexts.filterToggleButtonLabelOpen[currentLanguage]);
                }
            });
            if (closeFilterButtonDOM) closeFilterButtonDOM.addEventListener('click', () => {
                 if (!filterPanelDOM || !filterToggleButtonDOM) return;
                filterPanelDOM.classList.remove('filter-drawer-open');
                const icon = filterToggleButtonDOM.querySelector('i');
                icon.classList.remove('fa-times'); icon.classList.add('fa-bars');
                filterToggleButtonDOM.setAttribute('aria-label', uiTexts.filterToggleButtonLabelOpen[currentLanguage]);
            });
             console.log("Event listeners setup complete.");
        }

        function setupCalendarEventListeners() {
            console.log("Setting up calendar event listeners...");
            
            // Listen for course selection changes
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('course-selector')) {
                    handleCourseSelection(e.target);
                }
            });

            // Calendar creation button
            if (createCalendarButtonDOM) {
                createCalendarButtonDOM.addEventListener('click', showCalendarModal);
            }

            // Modal event listeners
            const calendarModal = document.getElementById('calendarModal');
            const closeCalendarModal = document.getElementById('closeCalendarModal');
            const cancelCalendarBtn = document.getElementById('cancelCalendarBtn');
            const downloadCalendarBtn = document.getElementById('downloadCalendarBtn');

            if (closeCalendarModal) {
                closeCalendarModal.addEventListener('click', hideCalendarModal);
            }
            if (cancelCalendarBtn) {
                cancelCalendarBtn.addEventListener('click', hideCalendarModal);
            }
            if (downloadCalendarBtn) {
                downloadCalendarBtn.addEventListener('click', downloadCalendar);
            }
            if (calendarModal) {
                calendarModal.addEventListener('click', (e) => {
                    if (e.target === calendarModal) {
                        hideCalendarModal();
                    }
                });
            }
        }

        function handleCourseSelection(checkbox) {
            const courseId = checkbox.getAttribute('data-course-id');
            const courseData = JSON.parse(checkbox.getAttribute('data-course-data'));
            
            if (checkbox.checked) {
                selectedCourses.add(courseId);
            } else {
                selectedCourses.delete(courseId);
            }
            
            updateCalendarButtonVisibility();
        }

        function updateCalendarButtonVisibility() {
            const count = selectedCourses.size;
            if (selectedCountDOM) {
                selectedCountDOM.textContent = count;
            }
            
            if (createCalendarButtonDOM) {
                if (count > 0) {
                    createCalendarButtonDOM.classList.remove('hidden');
                } else {
                    createCalendarButtonDOM.classList.add('hidden');
                }
            }
        }

        function showCalendarModal() {
            if (selectedCourses.size === 0) {
                alert(currentLanguage === 'et' ? 'Palun vali vähemalt üks kursus.' : 'Please select at least one course.');
                return;
            }

            // Get selected course data
            const selectedCourseData = [];
            selectedCourses.forEach(courseId => {
                const checkbox = document.querySelector(`[data-course-id="${courseId}"]`);
                if (checkbox) {
                    const courseData = JSON.parse(checkbox.getAttribute('data-course-data'));
                    selectedCourseData.push(courseData);
                }
            });

            generateCalendarView(selectedCourseData);
            document.getElementById('calendarModal').classList.remove('hidden');
        }

        function hideCalendarModal() {
            document.getElementById('calendarModal').classList.add('hidden');
        }

        function generateCalendarView(courses) {
            const calendarView = document.getElementById('calendarView');
            const calendarCourseCount = document.getElementById('calendarCourseCount');
            
            // Count total sessions
            const totalSessions = courses.reduce((sum, course) => sum + course.sessions.length, 0);
            
            if (calendarCourseCount) {
                calendarCourseCount.textContent = `${courses.length} ${currentLanguage === 'et' ? 'kursust' : 'courses'}, ${totalSessions} ${currentLanguage === 'et' ? 'sessiooni' : 'sessions'}`;
            }

            // Group sessions by date
            const sessionsByDate = {};
            courses.forEach(course => {
                course.sessions.forEach(session => {
                    const date = session.date;
                    if (!sessionsByDate[date]) {
                        sessionsByDate[date] = [];
                    }
                    sessionsByDate[date].push({
                        ...session,
                        courseName: course.aine,
                        courseCode: course.ainekood
                    });
                });
            });

            // Sort dates
            const sortedDates = Object.keys(sessionsByDate).sort((a, b) => {
                const [dayA, monthA, yearA] = a.split('.');
                const [dayB, monthB, yearB] = b.split('.');
                return new Date(yearA, monthA - 1, dayA) - new Date(yearB, monthB - 1, dayB);
            });

            // Generate calendar HTML
            let calendarHTML = '';
            sortedDates.forEach(date => {
                const [day, month, year] = date.split('.');
                const dateObj = new Date(year, month - 1, day);
                const dayName = currentLanguage === 'et' 
                    ? dateObj.toLocaleDateString('et-EE', { weekday: 'long' })
                    : dateObj.toLocaleDateString('en-GB', { weekday: 'long' });
                const formattedDate = currentLanguage === 'et'
                    ? dateObj.toLocaleDateString('et-EE', { day: '2-digit', month: '2-digit', year: 'numeric' })
                    : dateObj.toLocaleDateString('en-GB', { day: '2-digit', month: '2-digit', year: 'numeric' });

                const sessions = sessionsByDate[date].sort((a, b) => a.start.localeCompare(b.start));

                calendarHTML += `
                    <div class="border border-gray-200 rounded-lg overflow-hidden">
                        <div class="bg-tt-dark-blue text-white p-3">
                            <h3 class="font-bold text-lg">${dayName}</h3>
                            <p class="text-sm opacity-90">${formattedDate}</p>
                        </div>
                        <div class="p-3 space-y-2">
                            ${sessions.map(session => `
                                <div class="bg-gray-50 p-3 rounded border-l-4 border-tt-magenta">
                                    <div class="flex justify-between items-start">
                                        <div class="flex-grow">
                                            <h4 class="font-semibold text-tt-dark-blue">${session.courseName}</h4>
                                            <p class="text-sm text-gray-600">${session.courseCode} - ${session.tyyp}</p>
                                            ${session.oppejoud ? `<p class="text-sm text-gray-600"><i class="fas fa-user mr-1"></i>${session.oppejoud}</p>` : ''}
                                            ${session.ruum ? `<p class="text-sm text-gray-600"><i class="fas fa-map-marker-alt mr-1"></i>${session.ruum}</p>` : ''}
                                        </div>
                                        <div class="text-right">
                                            <p class="font-semibold text-tt-magenta">${session.start} - ${session.end}</p>
                                            ${session.oppenadalad ? `<p class="text-xs text-gray-500">${currentLanguage === 'et' ? 'Nädal' : 'Week'} ${session.oppenadalad}</p>` : ''}
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            });

            calendarView.innerHTML = calendarHTML;
        }

        function downloadCalendar() {
            // Get selected course data
            const selectedCourseData = [];
            selectedCourses.forEach(courseId => {
                const checkbox = document.querySelector(`[data-course-id="${courseId}"]`);
                if (checkbox) {
                    const courseData = JSON.parse(checkbox.getAttribute('data-course-data'));
                    selectedCourseData.push(courseData);
                }
            });

            // Generate ICS calendar file
            const icsContent = generateICS(selectedCourseData);
            
            // Download the file
            downloadCalendarFile(icsContent);
            
            // Hide modal after download
            hideCalendarModal();
        }

        function generateICS(courses) {
            const now = new Date();
            const timeStamp = now.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            
            let ics = [
                'BEGIN:VCALENDAR',
                'VERSION:2.0',
                'PRODID:-//TalTech//Course Calendar//EN',
                'CALSCALE:GREGORIAN',
                'METHOD:PUBLISH',
                `X-WR-CALNAME:TalTech Courses ${currentLanguage === 'et' ? 'Sügis' : 'Autumn'} 2025`,
                'X-WR-TIMEZONE:Europe/Tallinn'
            ];

            // Add all sessions from selected courses
            courses.forEach((course) => {
                course.sessions.forEach((session, index) => {
                    const eventId = `course-${session.ainekood}-${session.date}-${session.start}-${index}@taltech.ee`;
                    const startDateTime = formatDateTimeForICS(session.date, session.start);
                    const endDateTime = formatDateTimeForICS(session.date, session.end);
                    
                    ics.push('BEGIN:VEVENT');
                    ics.push(`UID:${eventId}`);
                    ics.push(`DTSTAMP:${timeStamp}`);
                    ics.push(`DTSTART:${startDateTime}`);
                    ics.push(`DTEND:${endDateTime}`);
                    ics.push(`SUMMARY:${session.aine} (${session.ainekood})`);
                    
                    let description = `${currentLanguage === 'et' ? 'Tüüp' : 'Type'}: ${session.tyyp}\\n`;
                    if (session.oppejoud) description += `${currentLanguage === 'et' ? 'Õppejõud' : 'Instructor'}: ${session.oppejoud}\\n`;
                    if (session.ryhmad) description += `${currentLanguage === 'et' ? 'Rühmad' : 'Groups'}: ${session.ryhmad}\\n`;
                    if (session.oppenadalad) description += `${currentLanguage === 'et' ? 'Õppenädal' : 'Study week'}: ${session.oppenadalad}`;
                    
                    ics.push(`DESCRIPTION:${description}`);
                    
                    if (session.ruum) {
                        ics.push(`LOCATION:${session.ruum}`);
                    }
                    
                    ics.push('STATUS:CONFIRMED');
                    ics.push('TRANSP:OPAQUE');
                    ics.push('END:VEVENT');
                });
            });

            ics.push('END:VCALENDAR');
            return ics.join('\r\n');
        }

        function formatDateTimeForICS(dateStr, timeStr) {
            if (!dateStr || !timeStr) return '';
            
            // Parse date (DD.MM.YYYY)
            const [day, month, year] = dateStr.split('.');
            
            // Parse time (HH:MM)
            const [hours, minutes] = timeStr.split(':');
            
            // Create ISO date string in Tallinn timezone
            const date = new Date(year, month - 1, day, parseInt(hours), parseInt(minutes));
            
            // Format as YYYYMMDDTHHMMSS (local time)
            const formatted = date.getFullYear() + 
                             String(date.getMonth() + 1).padStart(2, '0') + 
                             String(date.getDate()).padStart(2, '0') + 'T' +
                             String(date.getHours()).padStart(2, '0') + 
                             String(date.getMinutes()).padStart(2, '0') + 
                             String(date.getSeconds()).padStart(2, '0');
            
            return formatted;
        }

        function downloadCalendarFile(icsContent) {
            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `taltech-courses-${currentLanguage === 'et' ? 'sugis' : 'autumn'}-2025.ics`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
            
            // Show success message
            const totalSessions = Array.from(selectedCourses).reduce((sum, courseId) => {
                const checkbox = document.querySelector(`[data-course-id="${courseId}"]`);
                if (checkbox) {
                    const courseData = JSON.parse(checkbox.getAttribute('data-course-data'));
                    return sum + courseData.sessions.length;
                }
                return sum;
            }, 0);
            
            const message = currentLanguage === 'et' ? 
                `Kalender loodud! Laetud alla ${selectedCourses.size} kursust (${totalSessions} sessiooni).` :
                `Calendar created! Downloaded ${selectedCourses.size} courses (${totalSessions} sessions).`;
            alert(message);
        }

        async function initializeApp() {
            console.log("Initializing app...");
            if (loadingIndicatorDOM) loadingIndicatorDOM.classList.remove('hidden');
            try {
                // Embed data directly to avoid file:// protocol issues
                allCourses = [
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "1",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "06.09.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Tatjana Baraškova(vanemlektor)",
    "oppenadalad": "1",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAE0900",
    "tpg": "EDJR55_V",
    "date": "07.09.2025",
    "ainekood": "RAE0900",
    "aine": "Hüdro- ja pneumoajam",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Andres Koppel(lektor)",
    "oppenadalad": "2",
    "ryhmad": "EDJR35,EDJR55_V,EDJR75",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAA0470",
    "tpg": "EDJR55_V",
    "date": "13.09.2025",
    "ainekood": "RAA0470",
    "aine": "Elektrijaamad",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "3",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "20.09.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng",
    "oppejoud": "Kristjan Liivamägi(vanemlektor)|",
    "ruum": "SOC-209",
    "oppenadalad": "7",
    "ryhmad": "HAAB51,IABB51,IABB52,IABB53,TAAB31,TAAB32,TABB31,TABB32,TABB33,TABB34,TABB35,TABB36",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "15.10.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "10:00",
    "end": "11:30"
  },
  {
    "Kommentaar": "1. õppenädalal e-õpe Moodles",
    "keel": "Eesti keel",
    "tyyp": "harjutus",
    "oppejoud": "Kristjan Liivamägi(vanemlektor)",
    "ruum": "SOC-311",
    "oppenadalad": "7",
    "ryhmad": "HAAB51,IABB52",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "15.10.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "12:00",
    "end": "13:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-309",
    "oppenadalad": "7",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "15.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "14:00",
    "end": "17:00"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Marika Proover(nooremteadur)",
    "ruum": "SOC-316",
    "oppenadalad": "7",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/MNF5520",
    "tpg": "HAAB51",
    "date": "16.10.2025",
    "ainekood": "MNF5520",
    "aine": "Poliitikafilosoofia",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Mikk Lõhmus(lektor)",
    "ruum": "SOC-416",
    "oppenadalad": "7",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHL0026",
    "tpg": "HAAB51",
    "date": "17.10.2025",
    "ainekood": "HHL0026",
    "aine": "Riigiteaduste valikkursus",
    "start": "09:30",
    "end": "11:45"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-309",
    "oppenadalad": "7",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "17.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-314|",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "20.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Merilin Truuväärt(külalisõppejõud)",
    "ruum": "SOC-310|",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1151",
    "tpg": "HAAB51",
    "date": "21.10.2025",
    "ainekood": "HHM1151",
    "aine": "Avaliku sektori disainilabor",
    "start": "09:30",
    "end": "12:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-310|",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "21.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng",
    "oppejoud": "Kalle Ahi(lektor)",
    "ruum": "SOC-209",
    "oppenadalad": "8",
    "ryhmad": "HAAB51,IABB51,IABB52,IABB53,TAAB31,TAAB32,TABB31,TABB32,TABB33,TABB34,TABB35,TABB36",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "22.10.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "10:00",
    "end": "11:30"
  },
  {
    "Kommentaar": "1. õppenädalal e-õpe Moodles",
    "keel": "Eesti keel",
    "tyyp": "harjutus",
    "oppejoud": "Kristjan Liivamägi(vanemlektor)",
    "ruum": "SOC-311",
    "oppenadalad": "8",
    "ryhmad": "HAAB51,IABB52",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "22.10.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "12:00",
    "end": "13:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-309",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "22.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "14:00",
    "end": "17:00"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-309",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "23.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "09:30",
    "end": "12:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Andres Koppel(lektor)",
    "oppenadalad": "3",
    "ryhmad": "EDJR35,EDJR55_V,EDJR75",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAA0470",
    "tpg": "EDJR55_V",
    "date": "21.09.2025",
    "ainekood": "RAA0470",
    "aine": "Elektrijaamad",
    "start": "09:00",
    "end": "12:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Larissa Joonas(lektor)",
    "ruum": "VK1-25",
    "oppenadalad": "3",
    "ryhmad": "EDJR35,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0290",
    "tpg": "EDJR55_V",
    "date": "21.09.2025",
    "ainekood": "EVR0290",
    "aine": "Andmeside",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "5",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "04.10.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Larissa Joonas(lektor)",
    "ruum": "VK1-25",
    "oppenadalad": "5",
    "ryhmad": "EDJR35,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0290",
    "tpg": "EDJR55_V",
    "date": "05.10.2025",
    "ainekood": "EVR0290",
    "aine": "Andmeside",
    "start": "09:00",
    "end": "12:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Andres Koppel(lektor)",
    "oppenadalad": "5",
    "ryhmad": "EDJR35,EDJR55_V,EDJR75",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAA0470",
    "tpg": "EDJR55_V",
    "date": "05.10.2025",
    "ainekood": "RAA0470",
    "aine": "Elektrijaamad",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Andres Koppel(lektor)",
    "oppenadalad": "6",
    "ryhmad": "EDJR35,EDJR55_V,EDJR75",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAA0470",
    "tpg": "EDJR55_V",
    "date": "11.10.2025",
    "ainekood": "RAA0470",
    "aine": "Elektrijaamad",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "7",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "18.10.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Tatjana Baraškova(vanemlektor)",
    "oppenadalad": "7",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAE0900",
    "tpg": "EDJR55_V",
    "date": "19.10.2025",
    "ainekood": "RAE0900",
    "aine": "Hüdro- ja pneumoajam",
    "start": "09:00",
    "end": "12:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Larissa Joonas(lektor)",
    "ruum": "VK1-25",
    "oppenadalad": "7",
    "ryhmad": "EDJR35,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0290",
    "tpg": "EDJR55_V",
    "date": "19.10.2025",
    "ainekood": "EVR0290",
    "aine": "Andmeside",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "9",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "01.11.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Tatjana Baraškova(vanemlektor)",
    "oppenadalad": "9",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAE0900",
    "tpg": "EDJR55_V",
    "date": "02.11.2025",
    "ainekood": "RAE0900",
    "aine": "Hüdro- ja pneumoajam",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Andres Koppel(lektor)",
    "oppenadalad": "10",
    "ryhmad": "EDJR35,EDJR55_V,EDJR75",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAA0470",
    "tpg": "EDJR55_V",
    "date": "08.11.2025",
    "ainekood": "RAA0470",
    "aine": "Elektrijaamad",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "11",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "15.11.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Tatjana Baraškova(vanemlektor)",
    "oppenadalad": "11",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAE0900",
    "tpg": "EDJR55_V",
    "date": "16.11.2025",
    "ainekood": "RAE0900",
    "aine": "Hüdro- ja pneumoajam",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Larissa Joonas(lektor)",
    "ruum": "VK1-25",
    "oppenadalad": "13",
    "ryhmad": "EDJR35,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0290",
    "tpg": "EDJR55_V",
    "date": "29.11.2025",
    "ainekood": "EVR0290",
    "aine": "Andmeside",
    "start": "09:00",
    "end": "12:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Viktor Rjabtšikov(lektor)",
    "oppenadalad": "13",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0230",
    "tpg": "EDJR55_V",
    "date": "29.11.2025",
    "ainekood": "EVR0230",
    "aine": "MATLAB ja numbrilised meetodid",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Tatjana Baraškova(vanemlektor)",
    "oppenadalad": "13",
    "ryhmad": "EDJR54_V,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/RAE0900",
    "tpg": "EDJR55_V",
    "date": "30.11.2025",
    "ainekood": "RAE0900",
    "aine": "Hüdro- ja pneumoajam",
    "start": "13:00",
    "end": "16:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+praktikum+harjutus",
    "oppejoud": "Larissa Joonas(lektor)",
    "ruum": "VK1-25",
    "oppenadalad": "15",
    "ryhmad": "EDJR35,EDJR55_V",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/EVR0290",
    "tpg": "EDJR55_V",
    "date": "13.12.2025",
    "ainekood": "EVR0290",
    "aine": "Andmeside",
    "start": "09:00",
    "end": "12:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Marika Proover(nooremteadur)",
    "ruum": "SOC-316",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/MNF5520",
    "tpg": "HAAB51",
    "date": "23.10.2025",
    "ainekood": "MNF5520",
    "aine": "Poliitikafilosoofia",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Janika Aben(külalisõppejõud)",
    "ruum": "SOC-417",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HOE6020",
    "tpg": "HAAB51",
    "date": "23.10.2025",
    "ainekood": "HOE6020",
    "aine": "Tööõigus",
    "start": "14:00",
    "end": "17:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Mikk Lõhmus(lektor)",
    "ruum": "SOC-416",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHL0026",
    "tpg": "HAAB51",
    "date": "24.10.2025",
    "ainekood": "HHL0026",
    "aine": "Riigiteaduste valikkursus",
    "start": "09:30",
    "end": "11:45"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Alexandros Pazaitis(teadur)",
    "ruum": "SOC-309",
    "oppenadalad": "8",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1150",
    "tpg": "HAAB51",
    "date": "24.10.2025",
    "ainekood": "HHM1150",
    "aine": "Tänapäeva ühiskonna väljakutsed",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Tõnu Pihelgas(tunnitasuline)",
    "ruum": "SOC-211a",
    "oppenadalad": "9",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HOL6010",
    "tpg": "HAAB51",
    "date": "27.10.2025",
    "ainekood": "HOL6010",
    "aine": "Euroopa Liidu õigus",
    "start": "16:00",
    "end": "19:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Merilin Truuväärt(külalisõppejõud)",
    "ruum": "SOC-309",
    "oppenadalad": "9",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1151",
    "tpg": "HAAB51",
    "date": "28.10.2025",
    "ainekood": "HHM1151",
    "aine": "Avaliku sektori disainilabor",
    "start": "09:30",
    "end": "12:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng",
    "oppejoud": "Kalle Ahi(lektor)",
    "ruum": "SOC-209",
    "oppenadalad": "9",
    "ryhmad": "HAAB51,IABB51,IABB52,IABB53,TAAB31,TAAB32,TABB31,TABB32,TABB33,TABB34,TABB35,TABB36",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "29.10.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "10:00",
    "end": "11:30"
  },
  {
    "Kommentaar": "1. õppenädalal e-õpe Moodles",
    "keel": "Eesti keel",
    "tyyp": "harjutus",
    "oppejoud": "Kristjan Liivamägi(vanemlektor)",
    "ruum": "SOC-211a|",
    "oppenadalad": "9",
    "ryhmad": "HAAB51,IABB52",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "29.10.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "12:00",
    "end": "13:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Marika Proover(nooremteadur)",
    "ruum": "SOC-316",
    "oppenadalad": "9",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/MNF5520",
    "tpg": "HAAB51",
    "date": "30.10.2025",
    "ainekood": "MNF5520",
    "aine": "Poliitikafilosoofia",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Merilin Truuväärt(külalisõppejõud)",
    "ruum": "SOC-309",
    "oppenadalad": "10",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1151",
    "tpg": "HAAB51",
    "date": "04.11.2025",
    "ainekood": "HHM1151",
    "aine": "Avaliku sektori disainilabor",
    "start": "09:30",
    "end": "12:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng",
    "oppejoud": "Kalle Ahi(lektor)",
    "ruum": "SOC-209",
    "oppenadalad": "10",
    "ryhmad": "HAAB51,IABB51,IABB52,IABB53,TAAB31,TAAB32,TABB31,TABB32,TABB33,TABB34,TABB35,TABB36",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "05.11.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "10:00",
    "end": "11:30"
  },
  {
    "Kommentaar": "1. õppenädalal e-õpe Moodles",
    "keel": "Eesti keel",
    "tyyp": "harjutus",
    "oppejoud": "Kristjan Liivamägi(vanemlektor)",
    "ruum": "SOC-211a|",
    "oppenadalad": "10",
    "ryhmad": "HAAB51,IABB52",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "05.11.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "12:00",
    "end": "13:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Marika Proover(nooremteadur)",
    "ruum": "SOC-316",
    "oppenadalad": "10",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/MNF5520",
    "tpg": "HAAB51",
    "date": "06.11.2025",
    "ainekood": "MNF5520",
    "aine": "Poliitikafilosoofia",
    "start": "13:30",
    "end": "16:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Janika Aben(külalisõppejõud)",
    "ruum": "SOC-417",
    "oppenadalad": "10",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HOE6020",
    "tpg": "HAAB51",
    "date": "06.11.2025",
    "ainekood": "HOE6020",
    "aine": "Tööõigus",
    "start": "14:00",
    "end": "17:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Tõnu Pihelgas(tunnitasuline)",
    "ruum": "SOC-211a",
    "oppenadalad": "11",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HOL6010",
    "tpg": "HAAB51",
    "date": "10.11.2025",
    "ainekood": "HOL6010",
    "aine": "Euroopa Liidu õigus",
    "start": "16:00",
    "end": "19:15"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng+harjutus",
    "oppejoud": "Merilin Truuväärt(külalisõppejõud)",
    "ruum": "SOC-309",
    "oppenadalad": "11",
    "ryhmad": "HAAB51",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/HHM1151",
    "tpg": "HAAB51",
    "date": "11.11.2025",
    "ainekood": "HHM1151",
    "aine": "Avaliku sektori disainilabor",
    "start": "09:30",
    "end": "12:30"
  },
  {
    "keel": "Eesti keel",
    "tyyp": "loeng",
    "oppejoud": "Kalle Ahi(lektor)",
    "ruum": "SOC-209",
    "oppenadalad": "11",
    "ryhmad": "HAAB51,IABB51,IABB52,IABB53,TAAB31,TAAB32,TABB31,TABB32,TABB33,TABB34,TABB35,TABB36",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "12.11.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "10:00",
    "end": "11:30"
  },
  {
    "Kommentaar": "1. õppenädalal e-õpe Moodles",
    "keel": "Eesti keel",
    "tyyp": "harjutus",
    "oppejoud": "Kristjan Liivamägi(vanemlektor)",
    "ruum": "SOC-211a|",
    "oppenadalad": "11",
    "ryhmad": "HAAB51,IABB52",
    "ainekavaurl": "https://ois2.taltech.ee/uusois/aine/TER0440",
    "tpg": "HAAB51",
    "date": "12.11.2025",
    "ainekood": "TER0440",
    "aine": "Rahanduse alused",
    "start": "12:00",
    "end": "13:30"
  }
];
                console.log("Courses loaded:", allCourses.length);

                // No need to process interests for schedule data

                activeFilters.teachingLanguage = ""; 
                activeFilters.searchTerm = "";
                activeFilters.searchFieldType = "all";

                compileUniqueSearchableTerms();
                filteredCourses = [...allCourses]; 
                
                // Set language first, which will trigger UI updates and filtering
                setLanguage('et'); 
                setupEventListeners(); // Setup listeners after initial data load and language set
                setupCalendarEventListeners(); // Setup calendar-specific listeners
                
                // Removed auto-switch - users can manually toggle views

            } catch (error) {
                console.error("Could not load or initialize courses:", error);
                if (courseListContainerDOM) {
                     courseListContainerDOM.innerHTML = `<p class="text-red-500 text-center col-span-full">Viga kursuste laadimisel (${error.message}). Palun kontrolli, et fail "courses.json" on olemas ja proovi hiljem uuesti.</p>`;
                } else {
                    alert(`Viga kursuste laadimisel (${error.message}). Palun kontrolli, et fail "courses.json" on olemas ja proovi hiljem uuesti.`);
                }
            } finally {
                 if (loadingIndicatorDOM) loadingIndicatorDOM.classList.add('hidden');
                 console.log("App initialization finished.");
            }
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>